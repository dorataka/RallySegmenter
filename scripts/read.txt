ã–ã£ãã‚Šå…¨ä½“åƒ

ã¾ãšä¿¯ç°å›³ã‹ã‚‰ï¼š
å­¦ç¿’ç”¨ãƒ©ã‚¤ãƒ³ï¼ˆãƒ¢ãƒ‡ãƒ«ã‚’è‚²ã¦ã‚‹ï¼‰
make_window_features.py
train_play_lgbm.py
predict_play_lgbm.pyï¼ˆå­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®æ¤œè¨¼ç”¨ãƒ„ãƒ¼ãƒ«ï¼‰

æ¨è«–ãƒ©ã‚¤ãƒ³ï¼ˆå‹•ç”» â†’ ãƒ©ãƒªãƒ¼åŒºé–“ï¼‰
features_to_smooth_segments.py
smooth_play_scoreï¼ˆä¸­ã®é–¢æ•°ï¼å‡¦ç†ï¼‰
smooth_csv_to_segments.py

ã§ã¯ã€1å€‹ãšã¤å¾©ç¿’ã—ã¦ã„ãã€‚

1. make_window_features.py
å½¹å‰²ï¼šå­¦ç¿’ç”¨ã®ã€Œçª“ä»˜ãç‰¹å¾´é‡ CSVã€ã‚’ä½œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¥åŠ›ï¼š
ãŸã¨ãˆã° features_input.csvï¼ˆ1ãƒ•ãƒ¬ãƒ¼ãƒ ï¼1è¡Œã®ç´ ã®ç‰¹å¾´é‡ï¼‰
t
motion / motion_mean_xx
audio / audio_mean_xx
pose
æ­£è§£ãƒ©ãƒ™ãƒ«ï¼ˆis_play ãªã©ï¼‰

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
ã€Œä½•ç§’çª“ã€ã‹ã‚’æ±ºã‚ã¦
ãã®çª“å†…ã® max / mean / std ãªã©ã‚’è¨ˆç®—
ãã‚Œã‚’ 1è¡Œã®ç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«ã«ã™ã‚‹
ã¤ã¾ã‚Šã€Œæ™‚ç³»åˆ—ã‚’ã¾ã¨ã‚ãŸâ€œã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç‰¹å¾´é‡â€ã€ã«å¤‰æ›

å‡ºåŠ›ï¼š
features_windowed.csv
å„è¡Œ = 1ã¤ã®æ™‚åˆ»ï¼ˆor ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰
ã‚«ãƒ©ãƒ  = è¤‡æ•°ã®é›†ç´„ç‰¹å¾´é‡ï¼ˆmotion_max_1s, audio_mean_1s, pose_max_1s ãªã©ï¼‰ï¼‹ ãƒ©ãƒ™ãƒ«

ğŸ‘‰ LightGBM ã«é£Ÿã‚ã›ã‚‹â€œæ•™å¸«ãƒ‡ãƒ¼ã‚¿â€ã‚’ä½œã‚‹ãŸã‚ã®å‰å‡¦ç†ä¿‚ã€‚

2. train_play_lgbm.py
å½¹å‰²ï¼šLightGBM ã§ã€Œplayã‹ã©ã†ã‹ã€ã‚’åˆ¤å®šã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¥åŠ›ï¼š
features_windowed.csvï¼ˆä¸Šã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä½œã£ãŸã‚„ã¤ï¼‰

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
ç‰¹å¾´é‡ã‚«ãƒ©ãƒ ã¨ãƒ©ãƒ™ãƒ«ã‚«ãƒ©ãƒ ã‚’é¸æŠ
train/valid ã«åˆ†å‰²
LightGBM ã§å­¦ç¿’
F1, precision/recall ãªã©ã‚’è¨ˆç®—
ãƒ™ã‚¹ãƒˆãªãƒ¢ãƒ‡ãƒ«ã‚’ä¿å­˜

å‡ºåŠ›ï¼š
stats/play_lgbm_model.txt ã¿ãŸã„ãªãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
å ´åˆã«ã‚ˆã£ã¦ã¯ feature importance ã‚„ãƒ­ã‚°ã‚‚ stats/ ã«å‡ºåŠ›

ğŸ‘‰ ã€Œp_play_raw ã‚’å‡ºã™ã‚¨ãƒ³ã‚¸ãƒ³(LGBM)ã€ã‚’è‚²ã¦ã‚‹ãƒ‘ãƒ¼ãƒˆã€‚

3. predict_play_lgbm.py

å½¹å‰²ï¼šå­¦ç¿’æ¸ˆã¿ LGBM ãƒ¢ãƒ‡ãƒ«ã§ p_play_raw ã‚’æ¨è«–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¥åŠ›ï¼š
features_windowed.csvï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
stats/play_lgbm_model.txtï¼ˆå­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ï¼‰

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
ãƒ¢ãƒ‡ãƒ«ã‚’ load
å„ã‚µãƒ³ãƒ—ãƒ«ã«å¯¾ã—ã¦ predict_proba ã¿ãŸã„ãªå½¢ã§ ã€Œãƒ©ãƒªãƒ¼ã§ã‚ã‚‹ç¢ºç‡ã€ï¼ p_play_raw ã‚’è¨ˆç®—
t ã¨ãƒšã‚¢ã«ã—ãŸå½¢ã§ä¿å­˜

å‡ºåŠ›ï¼š
play_lgbm_pred.csv ã¿ãŸã„ãª
t
p_play_raw

ğŸ‘‰ ã€ŒLGBM ã®ç´ ã®å‡ºåŠ›ï¼ˆã‚¬ã‚¿ã‚¬ã‚¿ã® p_play_raw ç³»åˆ—ï¼‰ã‚’å¾—ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã€ã€‚
ã€€å­¦ç¿’å¾Œã®æ¤œè¨¼ã‚„å¯è¦–åŒ–ã«ä½¿ã†ã€‚

4. smooth_play_score
å½¹å‰²ï¼šã‚¬ã‚¿ã‚¬ã‚¿ãª p_play_raw ã‚’ã€Œãªã‚ã‚‰ã‹ãªã‚¹ã‚³ã‚¢åˆ—ã€ã«åŠ å·¥ã™ã‚‹å‡¦ç†ï¼ˆé–¢æ•°ï¼‰
åå‰ã®é€šã‚Šã€â€œplay ã‚¹ã‚³ã‚¢ã‚’å¹³æ»‘åŒ–ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“â€ã€‚

å…¥åŠ›ï¼š
æ™‚ç³»åˆ— tï¼ˆç­‰é–“éš”ã® gridï¼‰
p_play_rawï¼ˆLGBMã‚„ä»–ãƒ¢ãƒ‡ãƒ«ã®ç”Ÿå‡ºåŠ›ï¼‰

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã®å…¸å‹ï¼š
ç§»å‹•å¹³å‡ / Gaussian / 1ç§’çª“ mean ãªã©ã®ãƒ•ã‚£ãƒ«ã‚¿ã§ãƒã‚¤ã‚ºå‰Šæ¸›
çŸ­ã„ã€Œãƒ”ã‚¯ãƒƒã€ã¨ã—ãŸã‚¹ãƒ‘ã‚¤ã‚¯ã‚’æŠ‘åˆ¶
è¶³ã‚Šãªã„ã¨ã“ã‚ã‚’è£œé–“

å‡ºåŠ›ï¼š
p_play_smoothï¼ˆ0ã€œ1 ã®é€£ç¶šã‚¹ã‚³ã‚¢ï¼‰

ğŸ‘‰ ã“ã®å‡ºåŠ›ãŒ ã€Œå¾Œã§ ã—ãã„å€¤å‡¦ç†ã—ã¦ segment ã«ã™ã‚‹ãŸã‚ã®ãƒ™ãƒ¼ã‚¹ã€ ã«ãªã‚‹ã€‚

smooth_play_score è‡ªä½“ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã„ã†ã‚ˆã‚Šã€Œfeatures_to_smooth_segments.py ã®ä¸­ã§ä½¿ã‚ã‚Œã‚‹å¿ƒè‡“éƒ¨é–¢æ•°ã€ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚

5. features_to_smooth_segments.py

å½¹å‰²ï¼šç‰¹å¾´é‡ CSV â†’ æ»‘ã‚‰ã‹ãªã‚¹ã‚³ã‚¢ â†’ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå€™è£œã¾ã§ä½œã‚‹ã€ä¸­é–“å·¥å ´

å…¥åŠ›ï¼š
features_input.csvï¼ˆã¾ãŸã¯ window åŒ–ã•ã‚ŒãŸä½•ã‹ï¼‰
ã‚‚ã—ãã¯ p_play_raw ã‚’å«ã‚“ã ç‰¹å¾´CSV

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
CSV ã‚’èª­ã¿è¾¼ã‚€ï¼ˆt, å„ç¨® feature, p_play_raw ãªã©ï¼‰
smooth_play_score ã‚’å‘¼ã‚“ã§ p_play_smooth ã‚’è¨ˆç®—
t, å„ feature, p_play_raw, p_play_smooth ã‚’ã¾ã¨ã‚ã¦ ã€Œå¹³æ»‘æ¸ˆã¿ç‰¹å¾´CSVã€ ã«ã™ã‚‹

å‡ºåŠ›ã®ä»£è¡¨ä¾‹ï¼š

features_with_play_smooth.csv
â†’ å¯è¦–åŒ–ã¨ debug ã«ä¾¿åˆ©ãªã€Œå…¨éƒ¨å…¥ã‚ŠCSVã€

ï¼ˆè¨­å®šã«ã‚ˆã£ã¦ã¯ï¼‰smooth_segments.csv ã¾ã§ä½œã‚‹å ´åˆã‚‚ã‚ã‚‹

ğŸ‘‰ ã€Œã‚¹ã‚³ã‚¢ã‚’æ»‘ã‚‰ã‹ã«ã—ã¦â€œsegmentation ã«å…¥ã‚Œã‚‹ç›´å‰ã®çŠ¶æ…‹â€ã«ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€ã€‚
ã€€ç”Ÿã®ç‰¹å¾´é‡ â†’ ã€Œãƒ©ãƒªãƒ¼ã£ã½ã•ã€ãŒæ™‚é–“çš„ã«ãªã‚ã‚‰ã‹ã€ã¨ã„ã†çŠ¶æ…‹ã¾ã§æŒã£ã¦ã„ãã€‚

6. smooth_csv_to_segments.py

å½¹å‰²ï¼šsmooth ãªã‚¹ã‚³ã‚¢ CSV â†’ æœ€çµ‚çš„ãªãƒ©ãƒªãƒ¼åŒºé–“ï¼ˆstart/endï¼‰ ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¥åŠ›ï¼š
features_with_play_smooth.csv ã‚ã‚‹ã„ã¯
ã€Œt, p_play_smoothã€ã®ã¿ã‚’å«ã‚€ smooth ç³» CSV

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š
p_play_smooth > thr ã§ 0/1 ã«äºŒå€¤åŒ–
é€£ç¶šã—ãŸ 1 ã®å¡Šã‚’ã€Œå€™è£œåŒºé–“ã€ã¨ã—ã¦æŠ½å‡º

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ•´å½¢ï¼š
min_len æœªæº€ã®çŸ­ã„åŒºé–“ã¯æ¨ã¦ã‚‹
max_gap ä»¥ä¸‹ã®éš™é–“ã¯å‰å¾Œã®ãƒ©ãƒªãƒ¼ã¨ãƒãƒ¼ã‚¸
å‰å¾Œã« pad_head / pad_tail ã‚’è¶³ã—ã¦è‡ªç„¶ã«åˆ‡ã‚‹

å‡ºåŠ›ï¼š
smooth_segments.csv
start_time, end_time ã®ãƒªã‚¹ãƒˆ
ã“ã‚ŒãŒãã®ã¾ã¾ã€Œã‚«ãƒƒãƒˆã™ã¹ããƒ©ãƒªãƒ¼åŒºé–“ã€ã¨ã—ã¦ä½¿ãˆã‚‹

ğŸ‘‰ features_to_smooth_segments.py ãŒã€Œæ»‘ã‚‰ã‹ã«ã™ã‚‹ä¿‚ã€ã ã¨ã™ã‚‹ã¨ã€
ã€€smooth_csv_to_segments.py ã¯ ã€Œæœ€çµ‚çš„ãªãƒ©ãƒªãƒ¼åŒºé–“ã‚’æ±ºã‚ã‚‹ä¿‚ã€ã€‚

ã¾ã¨ã‚ï¼šãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ä¸€æœ¬ã®ç·šã«ã™ã‚‹ã¨
å­¦ç¿’ãƒ©ã‚¤ãƒ³
features_input.csv
  â””â†’ make_window_features.py
        â””â†’ features_windowed.csv
              â”œâ†’ train_play_lgbm.py  â”€â”€â†’ stats/play_lgbm_model.txt
              â””â†’ predict_play_lgbm.pyï¼ˆæ¤œè¨¼ç”¨ï¼‰ â”€â”€â†’ play_lgbm_pred.csv

æ¨è«–ãƒ©ã‚¤ãƒ³ï¼ˆå‹•ç”» â†’ ãƒ©ãƒªãƒ¼åŒºé–“ï¼‰
å‹•ç”» â†’ ç‰¹å¾´é‡æŠ½å‡ºï¼ˆåˆ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ â†’ features_input.csvï¼ˆï¼‹ p_play_rawï¼‰

features_input.csv
  â””â†’ features_to_smooth_segments.py
        â”œâ†’ smooth_play_scoreï¼ˆå†…éƒ¨å‡¦ç†ã§ p_play_smooth ä½œæˆï¼‰
        â””â†’ features_with_play_smooth.csv

features_with_play_smooth.csv
  â””â†’ smooth_csv_to_segments.py
        â””â†’ smooth_segments.csv   â† æœ€çµ‚çš„ãª start/end ã®ãƒªã‚¹ãƒˆ